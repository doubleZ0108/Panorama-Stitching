首先我来简单介绍一下sift的基本流程，因为这部分老师在课堂上介绍过，所以我不会过多复述讲过的部分。

sift的基本流程包括三个部分：

1. 建立高斯金字塔
2. 极值点的定位
3. 确定关键点的主方向和描述子

> 建立金字塔的过程包括用不同的sigma来进行高斯卷积；将原始图像不断降阶采样，得到一系列大小不一的图像；对同一个八度的两幅相邻的图像做差得到插值图像。

> 之后极值点的定位，则是由DOG空间的局部极值点组成的，以中心点进行的3X3X3的相邻点极值比较。

> 最后回到原来的高斯金字塔图中，寻找与σ（尺度）相近的高斯图像， 在以关键点为中心的邻域窗口内采样，并用直方图统计邻域像素的梯度方向。

接下来稍微介绍一下每个步骤的流程和我觉得需要注意的内容。



建立高斯金字塔的过程中，

高斯金字塔模仿的是图像的不同的**尺度**，也可以理解成“图像的纵深”，图像原就会模糊而趋于整体，近就会清晰而关注细节。图像的尺度空间解决的问题，是考虑如何对图像在所有尺度下进行的描述问题。

> 实现方法中，高斯核是唯一的线性核，也就是说使用高斯核对图像模糊不会引入其他噪声，因此就选用了高斯核来构建图像的尺度。

而建立高斯金字塔的过程，实际上也就是将原始图像不断高斯卷积、降阶采样，得到一系列大小不一的图像的过程。

图像分组，组内分层，在同一组（子八度，octave）内，不同层图像的尺寸是一样的，后一层图像的高斯平滑因子σ是前一层图像的k倍；在不同组内，为了保证尺度空间的连续性， 后一组第一个图像是前一组 **倒数第三个** 图像的二分之一采样，图像大小是前一组的一半。



紧接着，极值点定位的过程，

是由DOG空间的局部极值点组成的。从每组的第二层开始，取一上一下两层，以中心点进行3X3X3一共26个相邻点的比较,检测其是否是图像域和尺度域的相邻点的极值。

这里涉及到了一系列的优化措施。

因为极值点的搜索是在离散空间中进行的，检测到的极值点并不是真正意义上的极值点。所以会通过泰勒展开模拟曲线方程，用有限差分代替导数计算，通过多次迭代(Lowe算法里最多迭代5次)，得到最终候选点的精确位置与尺度。

同时由于DoG对图像中的边缘有比较强的响应值，而一旦特征点落在图像的边缘上，这些点就是不稳定的点，所以还要根据“在横跨边缘的地方有较大的主曲率，而在垂直边缘的方向有较小的主曲率”这一性质，通过计算Hessian矩阵的直迹、行列式进行计算，删除曲率不符合性质的点。

此外还有阈值二值化、舍去低对比度的极值点等操作，不多赘述。



在高斯差分图中找到了极值点，之后便是回到尺度空间，以关键点为中心的邻域窗口内采样，并用直方图统计邻域像素的梯度方向。直方图中最大值作为该关键点的主方向。

为了增强匹配的鲁棒性，保留峰值大于主方向峰值80％的方向作为该关键点的辅方向。

同时为了防止某个梯度方向角度因受到噪声的干扰而突变，我们还需要对梯度方向直方图进行平滑处理。

之后就是熟悉的4\*4\*8=128个描述子的生成。





这是代码运行的结果。

到此，通过sift算法生成了一幅图像的关键点和描述子。